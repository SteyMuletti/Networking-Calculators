import nmap
import requests

# Get target IP address or range from user
target = input("Enter the target IP address or range (in CIDR notation): ")

# Use Nmap to scan for open ports on the target
nm = nmap.PortScanner()
nm.scan(hosts=target, arguments='-p 1-65535 -sS')

for host in nm.all_hosts():
    print(f"Scanning host: {host}")
    for proto in nm[host].all_protocols():
        print(f"Protocol: {proto}")
        ports = nm[host][proto].keys()
        for port in ports:
            try:
                cve_id = nm[host][proto][port]['cve']
            except KeyError:
                cve_id = None
            print(f"Port: {port} is open. CVE: {cve_id}")
            if cve_id:
                # Query Virustotal API for any known malware or exploits related to the CVE
                url = f"https://www.virustotal.com/api/v3/intelligence/search?query={cve_id}"
                headers = {"x-apikey": "fb6a76f0316ab24f0b82a26fa05480fa5ba190e2e45a836152e1b4e8df14117d"}
                response = requests.get(url, headers=headers)
                if response.status_code == 200:
                    json_data = response.json()
                    if json_data['data']:
                        print(f"Malware or exploits associated with CVE {cve_id}:")
                        for entry in json_data['data']:
                            print(f"{entry['attributes']['description']}")
