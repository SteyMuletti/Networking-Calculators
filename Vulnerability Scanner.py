import nmap
import requests
import subprocess

# Get target IP address or range from user
target = input("Enter the target IP address or range (in CIDR notation): ")

# Use Nmap to scan for open ports and vulnerabilities on the target
nm = nmap.PortScanner()
nm.scan(hosts=target, arguments='-sS -sV --script=vulners')

for host in nm.all_hosts():
    print(f"Scanning host: {host}")
    for proto in nm[host].all_protocols():
        print(f"Protocol: {proto}")
        ports = nm[host][proto].keys()
        for port in ports:
            try:
                cve_id = nm[host][proto][port]['cve'][0]
            except KeyError:
                cve_id = None
            print(f"Port: {port} is open. CVE: {cve_id}")
            if cve_id:
                # Query Virustotal API for any known malware or exploits related to the CVE
                url = f"https://www.virustotal.com/api/v3/intelligence/search?query={cve_id}"
                headers = {"x-apikey": "<you're-API-key>"}
                response = requests.get(url, headers=headers)
                if response.status_code == 200:
                    json_data = response.json()
                    if json_data['data']:
                        print(f"Malware or exploits associated with CVE {cve_id}:")
                        for entry in json_data['data']:
                            print(f"{entry['attributes']['description']}")

                        # Check if exploit is available in Metasploit Framework
                        msfconsole_cmd = f"msfconsole -q -x 'search {cve_id}'"
                        output = subprocess.run(msfconsole_cmd, shell=True, stdout=subprocess.PIPE)
                        if output.stdout.decode():
                            print(f"Exploit for CVE {cve_id} available in Metasploit Framework:")
                            print(output.stdout.decode())
                        else:
                            print(f"No exploit for CVE {cve_id} found in Metasploit Framework")
